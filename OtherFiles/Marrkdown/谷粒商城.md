# 谷粒商城

# 1. Spring Cloud Alibaba

## 1.1 Nacos

### 1.1.1 使用 Nacos 作为配置中心统一管理配置

#### 1.1.1.1 引入依赖

```xml
<dependency>
	<groupId>com.alibaba.cloud</groupId>
	<artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
</dependency>
<dependency>
	<groupId>org.springframework.cloud</groupId>
	<artifactId>spring-cloud-starter-bootstrap</artifactId>
</dependency>
```

#### 1.1.1.2 创建 bootstrap.properties

```properties
spring.application.name=coupon
spring.cloud.nacos.config.server-addr=127.0.0.1:8848
```

#### 1.1.1.3 给配置中心默认添加一个 Data Id 为 “当前应用名.properties” 的数据集

#### 1.1.1.4 动态获取配置

@RefreshScope：动态获取刷新配置；

@Value("$(当前配置项名)")：获取配置。

#### 1.1.3.5 如果配置中心和当前 属性文件定义了相同属性，则优先使用配置中心中定义的属性

### 1.1.2 细节

#### 1.1.2.1 命名空间

实现配置隔离，默认 public，新增的所有配置都在 public 名称空间下。

依据环境隔离：开发、测试、生产。

```	properties
# 修改命名空间，值为命名空间的 id
spring.cloud.nacos.config.namespace=8f3c79e1-b692-4cf3-a77b-77e65d777546
```

每一个微服务之间互相隔离：每一个微服都创建自己的命名空间，只加载自己命名空间下的所有配置。

#### 1.1.2.2 配置集

所有的配置的集合。

#### 1.1.2.3 配置集 ID

Data ID：类似文件名。

#### 1.1.2.4 配置分组

默认所有配置集都属于 DEFAULT_GROUP 组。

### 1.1.3 同时加载多个配置文件

微服务的任何配置文件都可以放到配置中心中，只需要在 bootstrap.prpperties 中说明加载到配置中心中哪些文件即可。

# 2. Spring Cloud

## 2.1 Feign 声明式远程调用

## 2.2 Gateway

### 2.2.1 简介

网关作为流量的入口，常用功能包括路由转发、权限校验、限流控制等。而 GateWay 作为 Spring Cloud 官方推出的第二代网关框架，取代了 Zuul 网关。

网关提供 API 的**全托管服务**、丰富的 API 管理功能，辅助企业管理大规模的 API，以降低管理成本和安全风险，包括**协议适配**、**协议转发**、**安全策略**、**防刷**、**流量**、**监控日志**等功能。

Spring Cloud Gateway 旨在提供一种简单而有效的方式来**对** **API 进行路由**，并为他们提供**切面**。例如，**安全性**、**监控**/**指标**、和**弹性兼容**。

